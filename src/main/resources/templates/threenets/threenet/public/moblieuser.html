<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>用户信息</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../public/layui/css/layui.css">
    <link rel="stylesheet" href="../../public/css/commer.css">
    <link rel="stylesheet" type="text/css" href="../../public/dataTables/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../client/threenets/css/head.css">

</head>

<body>
    <div style="width:850px;margin:10px auto;">
        <div style="padding-top:10px;padding-left:0px;font-size:16px;">
            手机号：<input type="text" id="ringMsisdn" maxlength="11">
            <button type="button" class="btn btn-primary" id="sear" onclick="getUserInfoByRingMsisdn();">搜索</button>
        </div>
        <div class="layui-row per">
            <div class="layui-col-md4">
                <div class="grid-demo grid-demo-bg1 lt">用户当前信息</div>
            </div>
        </div>
        <table class="layui-table" id="userInfoTable" style="width:850px">
            <thead>
                <tr>
                    <th>集团名称</th>
                    <th>所属SA</th>
                    <th>加入时间</th>
                    <th>到期时间</th>
                    <th>支付方式</th>
                    <th>免短信</th>
                    <th>当前铃音</th>
                    <th>付费状态</th>
                </tr>
            </thead>
            <tbody>
                <tr class="userInfoTable">
<!--                    <td>佛山照明鸿昌灯饰6</td>-->
<!--                    <td>中高俊聪</td>-->
<!--                    <td>2019-02-21 12:12:23</td>-->
<!--                    <td>2019-02-21 12:12:23</td>-->
<!--                    <td>8元支付</td>-->
<!--                    <td>否</td>-->
<!--                    <td>暂无数据</td>-->
<!--                    <td>欠费</td>-->
                </tr>
            </tbody>
        </table>
        <div class="layui-row per">
            <div class="layui-col-md4">
                <div class="grid-demo grid-demo-bg1 lt">用户操作记录</div>
            </div>
        </div>
        <table class="layui-table" id="per" style="width:850px">
            <thead>
                <tr>
                    <th>用户号码</th>
                    <th>操作记录</th>
                    <th>操作时间</th>
                </tr>
            </thead>
            <tbody class="tbody"> </tbody>
<!--            <tbody>-->
<!--                <tr>-->
<!--                    <td>12345678912</td>-->
<!--                    <td>系统通过10658830端口向用户下发开通业务确认短信成功</td>-->
<!--                    <td>2019-03-27T11:48:01</td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td>12345678912</td>-->
<!--                    <td>用户作为集团管理员被（中高俊聪）添加至集团：佛山照明鸿昌灯饰6</td>-->
<!--                    <td>2019-02-27T11:48:01</td>-->
<!--                </tr>-->
<!--            </tbody>-->
        </table>
    </div>
</body>
<script src="../../public/js/jquery-2.1.4.min.js"></script>
<script src="../../public/layui/layui.js"></script>
<script type="text/javascript" src="../../public/dataTables/jquery.dataTables.min.js"></script>
<script type="text/javascript" th:src="@{/public/layui/layui.js}"></script>
<script type="text/javascript" th:src="@{/public/layui/lay/modules/layer.js}"></script>
<script type="text/javascript" th:src="@{/public/js/ajax.js}"></script>
<script>

    //搜索
    /* 工具箱--》用户信息获取 */
    function getUserInfoByRingMsisdn(){
        var ringMsisdn = $("#ringMsisdn").val();
        if(ringMsisdn.length < 11){
            $(".userInfoTable").html("<td colspan='8' style='color:#F00;'>请输入正确的移动手机号码！</td>");
            $(".tbody").html("<tr><td colspan='3' style='color:#F00;'>请输入正确的移动手机号码！</td></tr>");
            return;
        }else{
            var url = "/threenets/getUserInfoByRingMsisdn/"+ringMsisdn;
            $.post(url, {
                "ringMsisdn" : ringMsisdn
            }, function(data, textstatus) {
                if(data != null){
                    if(data.total == 0){
                        $(".userInfoTable").html("<td colspan='8' style='color:#F00;'>抱歉,系统没有查询到数据</td>");
                        $(".tbody").html("<tr><td colspan='3' style='color:#F00;'>抱歉,系统没有查询到数据</td></tr>");
                        return;
                    }
                    var userLog = data.userLog;
                    var userCurrentInfo = data.userCurrentInfo;
                    var str = "";
                    if(userCurrentInfo != null){
                        str += "<td>"+userCurrentInfo.group+"</td>";
                        str += "<td>"+userCurrentInfo.sa+"</td>";
                        str += "<td>"+userCurrentInfo.ctime+"</td>";
                        str += "<td>"+userCurrentInfo.closeTime+"</td>";
                        if(userCurrentInfo.payType == "GE"){
                            str += "<td>"+userCurrentInfo.price+"元个付</td>";
                        }
                        if(userCurrentInfo.applyForSmsNotification == 0){
                            str += "<td>否</td>";
                        }
                        str += "<td>"+userCurrentInfo.userRingName+"</td>";
                        if(userCurrentInfo.freezeStatus == 0){
                            str += "<td>正常</td>";
                        }else{
                            str += "<td>欠费</td>";
                        }
                        $(".userInfoTable").html(str);
                    }else{
                        $(".userInfoTable").html("<td colspan='8' style='color:#F00;'>抱歉,系统没有查询到数据</td>");
                    }
                    if(userLog != null){
                        var str = "";
                        for(var i = 0; i < userLog.length; i++){
                            str += "<tr>";
                            str += "<td>"+userLog[i].msisdn+"</td>";
                            str += "<td>"+userLog[i].content+"</td>";
                            str += "<td>"+userLog[i].ctime+"</td>";
                            str += "</tr>";
                        }
                        $(".tbody").html(str);
                    }else{
                        $(".tbody").html("<tr><td style='color:#F00;'>抱歉,系统没有查询到数据</td></tr>");
                    }
                }else{
                    tipDialog("获取失败");
                }
            }, "json");

    }
    // function getUserInfoByRingMsisdn(){
    //     var ringMsisdn = $("#ringMsisdn").val();
    //     var url = "/threenets/getUserInfoByRingMsisdn/"+ringMsisdn;
    //     AjaxPut(url,{},function (res) {
    //         if (res.code == 200 && res.data) {
    //             layer.msg('查找到了用户！', {icon: 6, time: 3000});
    //             $("#userInfoTable").DataTable().ajax.reload(null, false);
    //         } else {
    //             layer.msg(res.msg, {icon: 5, time: 3000});
    //         }
    //     });

    }


</script>

</html>
