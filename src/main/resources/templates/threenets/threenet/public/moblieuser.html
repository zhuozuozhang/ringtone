<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>用户信息</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../public/layui/css/layui.css">
    <link rel="stylesheet" href="../../public/css/commer.css">
    <link rel="stylesheet" type="text/css" href="../../public/dataTables/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../client/threenets/css/head.css">

</head>

<body>
    <div style="width:850px;margin:10px auto;">
        <div style="padding-top:10px;padding-left:0px;font-size:16px;">
            手机号：<input type="tel" id="ringMsisdn">
            <button type="button" class="btn btn-primary" id="sear" onclick="getUserInfoByRingMsisdn();">搜索</button>
            <button type="button" class="btn btn-primary" id="sear" onclick="resetRingMsisdnText();">清空</button>
        </div>
        <div class="layui-row per">
            <div class="layui-col-md4">
                <div class="grid-demo grid-demo-bg1 lt">用户当前信息</div>
            </div>
        </div>
        <table class="layui-table" id="userInfoTable" style="width:850px">
            <thead>
                <tr>
                    <th>集团名称</th>
                    <th>所属SA</th>
                    <th>加入时间</th>
                    <th>到期时间</th>
                    <th>支付方式</th>
                    <th>免短信</th>
                    <th>当前铃音</th>
                    <th>付费状态</th>
                </tr>
            </thead>
            <tbody class="userInfoTable">
<!--                <tr >-->
<!--                    <td>佛山照明鸿昌灯饰6</td>-->
<!--                    <td>中高俊聪</td>-->
<!--                    <td>2019-02-21 12:12:23</td>-->
<!--                    <td>2019-02-21 12:12:23</td>-->
<!--                    <td>8元支付</td>-->
<!--                    <td>否</td>-->
<!--                    <td>暂无数据</td>-->
<!--                    <td>欠费</td>-->
<!--                </tr>-->
            </tbody>
        </table>
        <div class="layui-row per">
            <div class="layui-col-md4">
                <div class="grid-demo grid-demo-bg1 lt">用户操作记录</div>
            </div>
        </div>
        <table class="layui-table" id="per" style="width:850px">
            <thead>
                <tr>
                    <th>用户号码</th>
                    <th>操作记录</th>
                    <th>操作时间</th>
                </tr>
            </thead>
            <tbody class="tbody"> </tbody>
<!--            <tbody>-->
<!--                <tr>-->
<!--                    <td>12345678912</td>-->
<!--                    <td>系统通过10658830端口向用户下发开通业务确认短信成功</td>-->
<!--                    <td>2019-03-27T11:48:01</td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td>12345678912</td>-->
<!--                    <td>用户作为集团管理员被（中高俊聪）添加至集团：佛山照明鸿昌灯饰6</td>-->
<!--                    <td>2019-02-27T11:48:01</td>-->
<!--                </tr>-->
<!--            </tbody>-->
        </table>
    </div>
</body>
<script src="../../public/js/jquery-2.1.4.min.js"></script>
<script src="../../public/layui/layui.js"></script>
<script type="text/javascript" src="../../public/dataTables/jquery.dataTables.min.js"></script>
<script type="text/javascript" th:src="@{/public/layui/layui.js}"></script>
<script type="text/javascript" th:src="@{/public/layui/lay/modules/layer.js}"></script>
<script type="text/javascript" th:src="@{/public/js/ajax.js}"></script>
<script>

    //搜索
    /* 工具箱--》用户信息获取 */
    function getUserInfoByRingMsisdn() {
        var ringMsisdn = $("#ringMsisdn").val().trim();
        if (ringMsisdn == null || ringMsisdn == "") {
            layer.msg("请输入手机号", {icon: 0, time: 3000});
            return;
        } else if (ringMsisdn.length < 11) {
            layer.msg("请输入正确的移动手机号码！");
            // $(".userInfoTable").html("<td colspan='8' style='color:#F00;'>请输入正确的移动手机号码！</td>");
            // $(".tbody").html("<tr><td colspan='3' style='color:#F00;'>请输入正确的移动手机号码！</td></tr>");
            return;
        }
        var url = "/threenets/getUserInfoByRingMsisdn/" + ringMsisdn;
        AjaxPut(url,{
            ringMsisdn : ringMsisdn
        },function (res) {
            if(res.code == 200 && res.data){
                var data = res.data;
                if(data.total == 0){
                    $(".userInfoTable").html("<td colspan='8' style='color:#F00;'>抱歉,系统没有查询到数据</td>");
                    $(".tbody").html("<tr><td colspan='3' style='color:#F00;'>抱歉,系统没有查询到数据</td></tr>");
                    return;
                }
                var userInfo = $.parseJSON(data.userInfo);
                var userLog = userInfo.userLog;
                var userCurrentInfo = userInfo.userCurrentInfo;
                if(userLog.length == 0 && userCurrentInfo.length == 0){
                    $(".userInfoTable").html("");
                    $(".tbody").html("");
                    layer.msg("无数据",{icon: 2,time: 3000});
                    return;
                }
                if(userCurrentInfo.length == 0){
                    layer.msg("用户当前信息无数据",{icon: 2,time: 3000})
                }else{
                    var str = "";
                    str += "<tr>"
                    str += "<td>" + userCurrentInfo.group + "</td>";
                    str += "<td>" + userCurrentInfo.sa + "</td>";
                    str += "<td>" + userCurrentInfo.ctime + "</td>";
                    if(userCurrentInfo.closeTime == null){
                        str += "<td>未知</td>";
                    }else{
                        str += "<td>" + userCurrentInfo.closeTime + "</td>";
                    }
                    if (userCurrentInfo.payType == "GE") {
                        str += "<td>" + userCurrentInfo.price + "元个付</td>";
                    }
                    if (userCurrentInfo.applyForSmsNotification == 0) {
                        str += "<td>否</td>";
                    }
                    str += "<td>" + userCurrentInfo.userRingName + "</td>";
                    if (userCurrentInfo.freezeStatus == 0) {
                        str += "<td>正常</td>";
                    } else {
                        str += "<td>欠费</td>";
                    }
                    str += "</tr>";

                    $(".userInfoTable").html(str);
                }
                //用户操作记录
                if (userInfo.length == 0) {
                    layer.msg("用户操作记录列表无数据", {icon: 2, time: 3000});
                }else{
                    var str = "";
                    for (var i = 0; i < userLog.length; i++) {
                        str += "<tr>";
                        str += "<td>" + userLog[i].msisdn + "</td>";
                        str += "<td>" + userLog[i].content + "</td>";
                        str += "<td>" + userLog[i].ctime + "</td>";
                        str += "</tr>";
                    }
                    $(".tbody").html(str);
                }
            }else {
                layer(res.msg,{icon: 5,time: 3000});
            }
        });
    }

    function resetRingMsisdnText() {
        $("#ringMsisdn").val("");
    }

</script>

</html>
