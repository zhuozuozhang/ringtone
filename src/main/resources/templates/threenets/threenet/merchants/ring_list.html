<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>商户列表-铃音管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" type="text/css" th:href="@{/public/layui/css/layui.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/public/layui/css/modules/layer/default/layer.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/public/dataTables/jquery.dataTables.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/client/threenets/css/number_list.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/client/threenets/css/head.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/client/threenets/css/ring.css}">
    <script type="text/javascript" th:src="@{/public/js/jquery.min.js}"></script>
</head>

<body>
<!-- 头部 -->
<div th:include="threenets/threenet/common/include :: header"></div>
<div class="layui-row" id="mcontent">
    <div class="layui-col-xs1 mconl">
        <div class="grid-demo grid-demo-bg1">
            <div id="page-aside" class="aside">
                <ul class="nav">
                    <li class="management">
                        <a class="banner" href="javascript:;">商户管理</a>
                    </li>
                    <li id="apersonnel">
                        <a th:href="@{'/threenets/toMerchantsPhonePage/'+${orderId}}">号码管理</a>
                    </li>
                    <li id="ring" class="selected">
                        <a th:href="@{'/threenets/toMerchantsRingPage/'+${orderId}}">铃音管理</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="layui-col-xs11 mconr">
        <div class="grid-demo">
            <div class="layui-row contant" style="width:95%;">
                <div class="layui-col-md12" id="search">
                    <input type="hidden" id="orderId" th:value="${orderId}">
                    <input type="hidden" id="operate" value="1">
                    <div class="title-bar clearfix">
                        <h1 class="pull-cnter">
                            您正在以 <span style="color: red;" th:text="${companyName}"></span> 的管理员身份进行操作。
                        </h1>
                    </div>
                    <div style="padding:10px 0 0 10px;font-size:16px;">
                        操作：
                        <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" id="sears"
                                onclick="addRing();" style='background-color: #17a9ff!important;'>上传铃音
                        </button>
                    </div>
                    <div class="InternetOperators clear" style="margin-left:10px;margin-top:15px;">
                        <div class="yidong more InternetOperators-clicked" onclick="dianxin(this)">移动</div>
                        <div class="dianxin more" onclick="dianxin(this)">电信</div>
                        <div class="liantong more" onclick="dianxin(this)">联通</div>
                    </div>
                    <table class="layui-table" id="set" style="margin-left:10px;">
                        <thead>
                        <tr>
                            <th>序号</th>
                            <th>运营商</th>
                            <th>创建时间</th>
                            <th>铃音名称</th>
                            <th>铃音ID</th>
                            <th>铃音类型</th>
                            <th>在线试听</th>
                            <th>审核状态</th>
                            <th>备注</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<div th:include="threenets/threenet/common/head :: footer"></div>
<script>
    $(".index2").addClass("active");
    //分页
    $(document).ready(function () {
        showTable();
    });

    function showTable() {
        let params = {
            "id": $('#orderId').val(),
            "operate": $('#operate').val(),
        }
        var columns = [
            {"data": "id"},
            {"data": "operate"},
            {"data": "createTime"},
            {"data": "ringName"},
            {"data": "orderId"},
            {"data": "ringType"},
            {"data": "ringWay"},
            {"data": "ringStatus"},
            {"data": "remark"}
        ];
        var columnDefs = [{
            targets: [1],
            render: function (data, type, row, meta) {
                if (data == 1) {
                    return '移动'
                } else if (data == 2) {
                    return '电信'
                } else {
                    return '联通'
                }
            }
        }, {
            targets: [6],
            render: function (data, type, row, meta) {
                return '<a><span onclick="openPlayer('+row.id+');">试听</span></a>'
            }
        }, {
            targets: [7],
            render: function (data, type, row, meta) {
                if (data == 1) {
                    return '待审核'
                } else if (data == 2) {
                    return '激活中'
                } else if (data == 3) {
                    return '激活成功'
                } else {
                    return '激活失败'
                }
            }
        }, {
            targets: [9],
            render: function (data, type, row, meta) {
                var id = row.id;
                return '<i class="layui-icon" title="复制铃音" onclick="cloneRing(' + id + ')"><img src="../../client/threenets/images/copy.png" alt=""></i>' +
                    '<a href="/threenets/downloadRing/'+id+'"><i class="layui-icon layui-icon-download-circle" title="下载铃音"></i></a>' +
                    '<i class="layui-icon" title="查看广告词" onclick="Advertising(\'' + row.ringContent + '\');"><img src="../../client/threenets/images/see.png" alt=""></i>' +
                    '<i class="layui-icon layui-icon-delete" title="删除" onclick="deleteRing(' + id + ')"></i>'
            }
        }]
        page("#set", 15, params, "/threenets/getThreeNetsRingList", columns, columnDefs);
    }

    //添加铃音
    function addRing() {
        let orderId = $("#orderId").val();
        let operate = $("#operate").val();
        layer.open({
            type: 2,
            title: '上传铃音',
            area: ['650px', '550px'],
            content: '/threenets/toAddMerchantsRingPage?orderId='+orderId+'&operate='+operate
        });
    }

    //在线试听
    function openPlayer(id) {
        layer.open({
            type: 1,
            title: '在线试听',
            area: ['800px', '560px'],
            content: '<video id="ovideo" autoplay loop src="/threenets/playRing/'+id+'" controls="controls " allowfullscreen="true" quality="high" width="800px" height="514px" align="middle" allowscriptaccess="always" flashvars="isAutoPlay=true" type="application/x-shockwave-flash"></video>'
        });
    }

    //查看广告词
    function Advertising(content) {
        layer.open({
            title: '广告词',
            content: content
        });
    }

    //运营商切换
    function dianxin(obj) {
        $(".more").removeClass("InternetOperators-clicked");
        $(obj).addClass("InternetOperators-clicked");
        let className = obj.className;
        if (className.indexOf('yidong') >= 0) {
            $("#operate").val(1)
        } else if (className.indexOf('liantong') >= 0) {
            $("#operate").val(3)
        } else {
            $("#operate").val(2)
        }
        showTable();
    }
    //克隆铃音
    function cloneRing(id) {
        layer.confirm("你确定要克隆此条记录吗?", {
            btn: ["确定", "取消"] //按钮
        }, function () {
            AjaxPost("/threenets/cloneRing/"+id, {}, function (result) {
                layer.closeAll('dialog');//关闭弹层
                layer.msg(result.msg + "!", {icon: result.code == 500 ? 2 : 1, time: 1000});
                showTable();
            })
        }, function () {});
    }
    //删除铃音
    function deleteRing(id) {
        layer.confirm("你确定要删除此条记录吗?", {
            btn: ["确定", "取消"] //按钮
        }, function () {
            AjaxDelete("/threenets/deleteThreeNetsRing", {"id": id}, function (result) {
                layer.closeAll('dialog');//关闭弹层
                layer.msg(result.msg + "!", {icon: result.code == 500 ? 2 : 1, time: 1000});
                showTable();
            })
        }, function () {});
    }
</script>
</html>
